<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Display Webcam Stream</title>
    <style>
        canvas {
            -o-transform: scaleX(-1);
            -moz-transform: scaleX(-1);
            -webkit-transform: scaleX(-1);
            -ms-transform: scaleX(-1);
            transform: scaleX(-1);
        }
    </style>
</head>

<body>
    <video autoplay="true" id="videoElement" style="visibility:hidden;"></video>
    <canvas style="background-color:blue;"></canvas>
    <img src="tardigrade.png" id="tardigrade" style="visibility:hidden;">

    <div id="color"> This is a test </div>

    <script>
        // Put variables in global scope to make them available to the browser console.
        const video = document.querySelector('video');
        const canvas = document.querySelector('canvas');
        const ctx = canvas.getContext('2d');
        const color = document.getElementById('color');
        const tardigrade = document.getElementById('tardigrade')



        setInterval(function () {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.drawImage(tardigrade, 100, 100, 50, 50)
        }, 33);

        function pick(event) {
            var x = event.layerX;
            var y = event.layerY;
            var pixel = ctx.getImageData(x, y, 1, 1);
            var data = pixel.data;
            var rgba = 'rgba(' + data[0] + ', ' + data[1] + ', ' + data[2] + ', ' + (data[3] / 255) + ')';
            color.style.background = rgba;
            color.textContent = "!!!" + rgba;
        }
        canvas.addEventListener('click', pick);

        function handleSuccess(stream) {
            window.stream = stream; // make stream available to browser console
            video.srcObject = stream;
        }
        function handleError(error) {
            console.log('navigator.MediaDevices.getUserMedia error: ', error.message, error.name);
        }
        navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then(handleSuccess).catch(handleError);
    </script>
</body>

</html>